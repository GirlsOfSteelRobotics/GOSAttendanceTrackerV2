{% load static %}

<!DOCTYPE HTML>
<html lang="en">
<head>
    <title>GoS Sign-In - GOS Attendance</title>

    <link rel="stylesheet" href="{% static 'attendance/bootstrap.min.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="{% static 'attendance/navbar.js' %}"></script>
    <link rel="stylesheet" href="{% static 'attendance/navbar.css' %}">
    <link rel="stylesheet" href="{% static 'attendance/attendance.css' %}">
    <style>
        /* Simple full-screen dark overlay shown during lookup/save */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.45);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .d-none { display: none !important; }
    </style>
    <script>
        // Wire up submit handlers to show loading state and disable inputs
        window.addEventListener('DOMContentLoaded', function () {
            // Toast notification initialization
            var resultMsg = "{{ result_msg|safe }}";
            if (resultMsg && resultMsg !== "None" && resultMsg !== "") {
                var toastEl = document.getElementById('statusToast');
                var toast = new bootstrap.Toast(toastEl, { delay: 5000 });
                toast.show();
            }

            function showLoadingAndDisable() {
                try {
                    var rfidInput = document.getElementById('rfid');
                    var nameInput = document.getElementById('full_name');
                    var rfidBtn = document.getElementById('rfid_submit');
                    var nameBtn = document.getElementById('name_submit');
                    // Use readOnly (not disabled) so values are still posted with the form
                    if (rfidInput) { rfidInput.setAttribute('aria-busy', 'true'); rfidInput.readOnly = true; }
                    if (nameInput) { nameInput.setAttribute('aria-busy', 'true'); nameInput.readOnly = true; }
                    if (rfidBtn) { rfidBtn.disabled = true; }
                    if (nameBtn) { nameBtn.disabled = true; }
                } catch (e) { /* no-op */ }
                var overlay = document.getElementById('loadingOverlay');
                if (overlay) { overlay.classList.remove('d-none'); }
            }

            var rfidForm = document.getElementById('rfid_form');
            if (rfidForm) {
                rfidForm.addEventListener('submit', function () {
                    showLoadingAndDisable();
                });
            }
            var nameForm = document.getElementById('name_form');
            if (nameForm) {
                nameForm.addEventListener('submit', function () {
                    showLoadingAndDisable();
                });
            }
        });
    </script>
</head>
<body id="gos">

{% include "attendance/shared/navbar.html" %}
<div class="container">

<div class="row text-center row-cols-6">
    <div class="col">&nbsp;</div>
    <div class="col-8">
        <img src="{% static 'gos_logo3.png' %}" class="img-fluid mx-auto d-block" alt="GOS Logo"/>
    </div>
    <div class="col">&nbsp;</div>
</div>

    <div class="row">
        <div class="col-md-12">
            <h3>SCRA visitors: Click <a href="{% url 'scra_signin' %}">here</a> to sign in.</h3>
            <p>&nbsp;</p>
        </div>
    </div>

    <form id="rfid_form" class="row g-3" action="{% url 'gos_log_attendance_rfid' %}" method="post">
{% csrf_token %}
    <div class="col-12">
        <legend><h1>GoS - Tap your RFID keyfob</h1></legend>
    </div>
    <div class="col-md-2">
        <label for="rfid" class="form-label">RFID</label>
    </div>
    <div class="col-md-8">
        <input type="number" id="rfid" name="rfid" class="form-control" autofocus="autofocus" autocomplete="off" aria-autocomplete="none">
    </div>
    <div class="col-md-2">
        <input id="rfid_submit" type="submit" value="Sign In" class="btn btn-primary">
    </div>
</form>

<br><br>

<form id="name_form" class="row g-3" action="{% url 'gos_log_attendance_name' %}" method="post">
{% csrf_token %}
    <div class="col-12">
        <legend><h1>GoS - Sign In with Full Name</h1></legend>
    </div>
    <div class="col-md-2">
        <label for="full_name" class="form-label">Full Name</label>
    </div>
    <div class="col-md-8">
        <input id="full_name" name="full_name" class="form-control" autocomplete="off" aria-autocomplete="none">
    </div>
    <div class="col-md-2">
        <input id="name_submit" type="submit" value="Sign In" class="btn btn-primary">
    </div>

</form>

<div class="row">
    <div class="col-md-12">
        <!-- Toast Container -->
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div id="statusToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header {% if good_result %}bg-success{% else %}bg-danger{% endif %} text-white">
                    <strong class="me-auto">Notification</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    {{ result_msg|safe }}
                </div>
            </div>
        </div>
    </div>
</div>

</div><!-- container //  -->

<!-- Loading overlay -->
<div id="loadingOverlay" class="loading-overlay d-none">
    <div class="text-center text-light">
        <div class="spinner-border" role="status" aria-hidden="true"></div>
        <div class="mt-3 h4">Please wait...</div>
        <div class="small">Looking up your card/name and saving the time</div>
    </div>
</div>

</body>
</html>