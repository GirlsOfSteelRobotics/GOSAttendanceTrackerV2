{% load static %}

<!DOCTYPE HTML>
<html lang="en">
<head>
    <title>Field Builders Sign-In - GOS Attendance</title>

    <link rel="stylesheet" href="{% static 'attendance/bootstrap.min.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="{% static 'attendance/navbar.js' %}"></script>
    <script src="{% static 'attendance/redirect_to_gos_signin_on_idle.js' %}"></script>
    <link rel="stylesheet" href="{% static 'attendance/navbar.css' %}">
    <link rel="stylesheet" href="{% static 'attendance/attendance.css' %}">
    <style>
        /* Simple full-screen dark overlay shown during lookup/save */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.45);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .d-none { display: none !important; }
    </style>

    <script>
window.addEventListener('DOMContentLoaded', function () {
    // Toast notification initialization
    var resultMsg = "{{ result_msg|safe }}";
    if (resultMsg && resultMsg !== "None" && resultMsg !== "") {
        var toastEl = document.getElementById('statusToast');
        var toast = new bootstrap.Toast(toastEl, { delay: 5000 });
        toast.show();
    }

    function showLoadingAndDisable() {
        try {
            var nameInput = document.getElementById('full_name');
            var submitBtn = document.querySelector('input[type="submit"]');
            
            if (nameInput) { nameInput.setAttribute('aria-busy', 'true'); nameInput.readOnly = true; }
            if (submitBtn) { submitBtn.disabled = true; }
        } catch (e) { /* no-op */ }
        var overlay = document.getElementById('loadingOverlay');
        if (overlay) { overlay.classList.remove('d-none'); }
    }

    var form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function () {
            showLoadingAndDisable();
        });
    }
});
    </script>
</head>
<body id="field">

{% include "attendance/shared/navbar.html" %}

<div class="container">

<div class="row text-center row-cols-6">
    <div class="col">&nbsp;</div>
    <div class="col-8">
        <img src="{% static 'field_logo.png' %}" class="img-fluid mx-auto d-block" alt="Field image"/>
    </div>
    <div class="col">&nbsp;</div>
</div>

<form action="{% url 'field_builders_log_attendance' %}" method="post">
{% csrf_token %}

    <div class="row">
        <div class="col-12">
            <legend><h1>Sign In as a Field Builder</h1></legend>
        </div>
    </div>

    <div class="row">
        <div class="col-md-2">
            <label class="form-label" for="full_name">Full Name</label>
        </div>

        <div class="col-md-8">
            <input class="form-control" id="full_name" name="full_name" list="field_builders" placeholder="Full Name" required>
            <datalist id="field_builders">
                {%  for buildier in field_builders %}
                <option value="{{ buildier.full_name }}">{{ buildier.full_name }}</option>
                {%  endfor %}
            </datalist>
        </div>

        <div class="col-md-2">
            <input type="submit" value="Sign In">
        </div>
    </div>
</form>

<div class="row">
    <div class="col-md-12">
        <!-- Toast Container -->
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div id="statusToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header {% if good_result %}bg-success{% else %}bg-danger{% endif %} text-white">
                    <strong class="me-auto">Notification</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    {{ result_msg|safe }}
                </div>
            </div>
        </div>
    </div>
</div>

</div><!-- container //  -->

<!-- Loading overlay -->
<div id="loadingOverlay" class="loading-overlay d-none">
    <div class="text-center text-light">
        <div class="spinner-border" role="status" aria-hidden="true"></div>
        <div class="mt-3 h4">Please wait...</div>
        <div class="small">Looking up your name and saving the time</div>
    </div>
</div>

</body>
</html>